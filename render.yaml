services:
  - type: web
    name: onevault-backend
    env: node
    plan: free
    region: singapore
    buildCommand: npm install && npx prisma generate && npx prisma migrate deploy && npm run build
    startCommand: npm run start:prod
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000

      # DATABASE (Set in Render Dashboard)
      - key: DATABASE_URL
        sync: false
      - key: DIRECT_URL
        sync: false

      # AUTHENTICATION (Auto-generated by Render)
      - key: JWT_ACCESS_SECRET
        generateValue: true
      - key: JWT_REFRESH_SECRET
        generateValue: true
      - key: JWT_ACCESS_EXPIRATION
        value: "1h"
      - key: JWT_REFRESH_EXPIRATION
        value: "7d"

      # SECURITY
      - key: PIN_SALT_ROUNDS
        value: "12"
      - key: PASSWORD_SALT_ROUNDS
        value: "12"

      # LOGGING
      - key: LOG_LEVEL
        value: info

      # EMAIL (Set in Render Dashboard)
      - key: SMTP_HOST
        value: "smtp.gmail.com"
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_USERNAME
        sync: false
      - key: SMTP_PASSWORD
        sync: false
      - key: SMTP_IS_SECURE
        value: "true"
      - key: SMTP_FROM
        sync: false

      # CLOUDINARY (Set in Render Dashboard)
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false
      - key: CLOUDINARY_FOLDER
        value: "onevault"

      # FIREBASE (Set in Render Dashboard)
      - key: FIREBASE_PROJECT_ID
        sync: false
      - key: FIREBASE_CLIENT_EMAIL
        sync: false
      - key: FIREBASE_PRIVATE_KEY
        sync: false
